---
START:
  type: dict
  mandatory:
    _content: CONTENT
  optional:
    _vars: VARS
  other: BLOCK
VARS:
  type: list
  elements: VAR
VAR: # Has special built-in checking
  type: dict
  optional:
    _locale: _text
    _type: _var_type
  other: _complex_value
BLOCK:
  type: union_with_types
  dict: DICT_BLOCK
  list: LIST_BLOCK
DICT_BLOCK: # Has special built-in checking
  type: dict
  optional:
    _content: CONTENT
    _vars: VARS
  other: BLOCK
LIST_BLOCK:
  type: list
  elements: INSTR
CONTENT:
  type: list
  elements: INSTR
INSTR:
  type: union_with_types
  str: _text
  dict: DICT_INSTR
DICT_INSTR:
  type: union_with_keys
  contexts:
    add: ADD
    back: BACK
    choice: CHOICE
    error: ERROR
    flavor: FLAVOR
    gosub: GOSUB
    goto: GOTO
    if: IF
    insert: INSERT
    lose: LOSE
    once: ONCE
    pass: PASS
    print: PRINT
    print_table: PRINT_TABLE
    random: RANDOM
    set: SET
    switch: SWITCH
ADD:
  type: dict
  mandatory:
    add: _requirement_specification
BACK:
  type: dict
  mandatory:
    back: _null
CHOICE:
  type: dict
  mandatory:
    choice: _text # Custom checking
  optional:
    text: _text
    require: _requirement_specification
    cost: _requirement_specification
    shown: _requirement_specification
    effects: EFFECTS_SPEC
EFFECTS_SPEC:
  type: union_with_types
  str: _addr
  list: CONTENT
ERROR:
  type: dict
  mandatory:
    error: _null
FLAVOR:
  type: dict
  mandatory:
    flavor: _text
IF:
  type: dict
  mandatory:
    if: CONDITION
    then: CONTENT
  optional:
    else: CONTENT
CONDITION:
  type: union_with_types
  str: _expr
  dict: DICT_CONDITION
  list: CONDITION_AND
CONDITION_AND:
  type: list
  elements: CONDITION
CONDITION_OR:
  type: list
  elements: CONDITION
DICT_CONDITION:
  type: union_with_keys
  contexts:
    has: CONDITION_HAS
    or: DICT_CONDITION_OR
DICT_CONDITION_OR:
  type: dict
  mandatory:
    or: CONDITION_OR
CONDITION_HAS:
  type: dict
  mandatory:
    has: _id
    in: _var_id
  optional:
    amount: _num_expr
INSERT:
  type: dict
  mandatory:
    insert: _id
    into: _var_id
LOSE:
  type: dict
  mandatory:
    lose: _requirement_specification
GOSUB:
  type: dict
  mandatory:
    gosub: _addr
GOTO:
  type: dict
  mandatory:
    goto: _addr
ONCE:
  type: dict
  mandatory:
    once: ONCE_SPEC
ONCE_SPEC:
  type: union_with_types
  str: _text
  list: CONTENT
PASS:
  type: dict
  mandatory:
    pass: _null
PRINT:
  type: dict
  mandatory:
    print: _text
  optional:
    style: _text
PRINT_TABLE:
  type: dict
  mandatory:
    print_table: _table_id
RANDOM:
  type: dict
  mandatory:
    random: RANDOM_EVENTS_SPEC
RANDOM_EVENTS_SPEC:
  type: union_with_types
  str: _addr_list
  dict: RANDOM_EVENT_DICT
RANDOM_EVENT_DICT:
  type: dict
  other: RANDOM_EVENT
RANDOM_EVENT:
  type: union_with_types
  null: _null
  list: CONTENT
SET:
  type: dict
  mandatory:
    set: _set_expr
  optional:
    show: _null
    to: _expr
SWITCH:
  type: dict
  mandatory:
    switch: _expr
  other: CASE_SPEC
CASE_SPEC:
  type: union_with_types
  str: _addr
  list: CONTENT
